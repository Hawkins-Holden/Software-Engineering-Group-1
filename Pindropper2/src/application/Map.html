<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head> 
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
    <title>Google Maps Javascript API v3 Example: Add Marker with open infowindow on map click</title> 
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuT9VzPqnYSaB5Os0U4mkI8C7CiuFzwao"></script> 
<!-- <script type="text/javascript" src="scripts/downloadxml.js"></script> -->
<style type="text/css">
html, body { height: 100%; width: 100%; } 
</style>
<script type="text/javascript"> 
//<![CDATA[
	
     // global "map" variable
      var map = null;
      var marker = null;
      var nums = 0;
      var latitude = 39.062214;
      var longitude = -97.227689;
      var test1 = 20.303;
      var test2 = -101.25;
      var testArray = [];
      var tempest = 0;
      var tester = "";

var infowindow = new google.maps.InfoWindow(
  { 
    size: new google.maps.Size(150,50)
  });

// A function to create the marker and set up the event window function 
function createMarker(latlng) {
	
	//testCallJavaFX(latlng);
    var marker = new google.maps.Marker({
        position: latlng,
        map: map,
        //zIndex: Math.round(latlng.lat()*-100000)<<5
        zIndex: Math.round(latlng.lat()*-100000)<<5
        });

    
    google.maps.event.trigger(marker, 'click');
    nums = latlng;
    
    return marker;
}

/*function addToArray(element){
	
	testArray[tempest] = element;
	tempest++;
	
}*/

function callJavaFX() {
	
	
	tempest = 0;
	
	while (tempest < 4){
	testArray[tempest] = app.getString(tempest);
	tempest++;
	}
	
	myLatLng = new google.maps.LatLng({lat: testArray[0], lng: testArray[1]});
	//myLatLng = new google.maps.LatLng({lat: test1, lng: test2});
	
	//app.callFromJavascript(testArray);
	
	marker = createMarker(myLatLng);
}

function testCallJavaFX(message2){
	app.testCall(message2);
}

function pleaseWork(latLng){
	if (marker) {
		//marker.setMap(null);
		marker = null;
	}
	//marker = createMarker(test);
	marker = createMarker(latLng);
	//callJavaFX();
}


	function placeMarkerAndPanTo(latLng, map) {
		marker = new google.maps.Marker({
			position : {lat: 41.9, lng: -93},
			map : map
		});
		map.panTo(latLng);
	}

	function initialize() {
		// create the map
		var myOptions = {
			zoom : 3,
			center : new google.maps.LatLng(latitude, longitude),
			mapTypeControl : true,
			mapTypeControlOptions : {
				style : google.maps.MapTypeControlStyle.DROPDOWN_MENU
			},
			navigationControl : true,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		}

		map = new google.maps.Map(document.getElementById("map_canvas"),
				myOptions);

		google.maps.event.addListener(map, 'click', function(event) {
		    //var myLatLng = event.latLng;
		    //var lat = myLatLng.lat();
		   // var lng = myLatLng.lng();
			//placeMarkerAndPanTo(event.latLng, map);
			//call function to create marker
			//pleaseWork(event.latLng);
			callJavaFX();
			//testCallJavaFX(event.latLng);
		});

	}

	//]]>
</script> 

  </head> 
<body style="margin:0px; padding:0px;" onload="initialize()"> 
 
    <!-- you can use tables or divs for the overall layout --> 
    <table border="1"> 
      <tr> 
        <td> 
           <div id="map_canvas" style="width: 800px; height: 480px"></div> <!-- This is where you change the size of the map -->
        </td> 
<!--         <td valign="top" style="width:150px; text-decoration: underline; color: #4444ff;">  -->
           <div id="side_bar"></div> 
        </td> 
      </tr> 
    </table> 
  
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> 
</script> 
<script type="text/javascript"> 
_uacct = "UA-162157-1";
urchinTracker();
</script> 

<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>   
<input type="button" class="button" value="Push If you DARE" onclick="callJavaFX();"/>
  </body> 
</html> 
